<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Shareable Libraries - Garmin Connect IQ Documentation</title>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; margin: 0; padding: 20px; }
        h1 { color: #333; }
        pre { background-color: #f5f5f5; padding: 10px; border-radius: 4px; overflow: auto; }
        code { font-family: monospace; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; }
        th { background-color: #f2f2f2; }
        img { max-width: 100%; }
    </style>
</head>
<body>
    <h1>Shareable Libraries</h1>
    <div class="c0123 c0126">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><meta charset="utf-8"/><meta content="(C) Copyright 2025" name="copyright"/><meta content="(C) Copyright 2025" name="DC.rights.owner"/><meta content="topic" name="DC.type"/><meta content="HTML5" name="DC.format"/><meta content="shareable-libraries" name="DC.identifier"/><link href="../../commonltr.css" rel="stylesheet" type="text/css"/><title>Shareable Libraries</title><main role="main"><article aria-labelledby="ariaid-title1" role="article"><h1 class="title topictitle1" id="ariaid-title1">Shareable Libraries</h1><div class="body"><p class="p">Developers can create custom Monkey C libraries, called Monkey Barrels, that contain source code and resource information that are easily shared across Connect IQ Projects.</p><p class="p">Monkey Barrels provide an easy way to store and reuse common code and resources that developers find useful. For example, many developers want a quick way to calculate time to sunrise or sunset. With Monkey Barrels, developers can store this code along with other common code and pull it into their various projects when useful. This saves time and effort allowing developers the ability to have maximum creativity.</p></div><article aria-labelledby="ariaid-title2" class="topic nested1" id="making-a-monkey-barrel"><h2 class="title topictitle2" id="ariaid-title2">Making a Monkey Barrel</h2><div class="body"><p class="p">From Visual Studio Code, Barrels can be created as a new project type:</p><ol class="ol"><li class="li"><p class="p">Use <em class="ph i">Ctrl + Shift + P</em> (<em class="ph i">Command + Shift + P</em> on the Mac) to summon the command palette</p></li><li class="li"><p class="p">Type "New Project" and select <em class="ph i">Monkey C: New Project</em></p></li><li class="li"><p class="p">When prompted with <em class="ph i">Set Project Name</em>, enter a name for your new project</p></li><li class="li"><p class="p">Select the project type <em class="ph i">Monkey Barrel</em></p></li><li class="li"><p class="p">Select the minimum API level</p></li><li class="li"><p class="p">Set the parent directory for your new project</p></li></ol><p class="p">Once the project is created, you can edit your supported products and permissions in the <em class="ph i">manifest.xml</em>. See <a class="xref" href="../Connect_IQ_Basics/Your_First_App.html#editing-the-supported-products">Editing the Supported Products</a> for more information. A specific check is in place to ensure that developers cannot have a Barrel with the name "Toybox". The Barrel has now been createdâ€”now it's time to fill it!</p><p class="p">Developers can think of Barrels as custom modules. In fact this is exactly how they should be set up:</p><pre class="pre codeblock c++"><code>module FooBarrel {

    (:Bars)           // Notice the annotations above the submodule names
    module Bars {
        // Create a counter var for the "Current Bars"
        var currentBars = 0;

        // Draw a "Bar"
        function drawBar() {
           // . . . draw a super awesome "Bar"
           return Bar;
        }

        // Increment the Bar counter
        function addBar(currentBars) {
           bars = currentBars;
           bars ++;
           return bars;
        }

        // Get the current Bars
        function getCurrentBars() {
            return currentBars;
        }
    }

    (:BarsToo)        // Notice this here too
    module BarsToo {
        function fancyBars() {
            // . . . Do a fancy thing
            return somethingFancy;
        }
    }

    (:Empty)          // An empty annotation
    module Empty {

        // A sub-module without an annotation
        module AlsoEmpty {
        }
    }

    // This module throws an error
    module throwsError {
    }
}</code></pre><p class="p">Developers can use annotations to denote sub-modules within their Barrels. Sub-modules with annotations (i.e. the <code class="ph codeph">(:Bars)</code> annotation above) allow developers to import certain sections of code without importing the entire Barrel. If a module directly below the namespace is found at compile time that is not decorated with an annotation, a warning will be generated. A module lacking an annotation that is found within a module decorated with an annotation will also generate a warning (i.e. <code class="ph codeph">AlsoEmpty</code> module above). See <span class="xref"></span> for more information on how to include Barrels and specific annotations.</p><p class="p">Annotations must also be configured in the manifest for the Barrel project:</p><ol class="ol"><li class="li"><p class="p">Double click the Barrel <code class="ph codeph">manfest.xml</code></p></li><li class="li"><p class="p">Summon the command palette and run the <em class="ph i">Monkey C: Edit Annotations</em> command</p></li><li class="li"><p class="p">Select <em class="ph i">Add Annotation</em></p></li><li class="li"><p class="p">Input your annotation name</p></li></ol><p class="p">The annotations will be available to use in the Barrel project.</p><p class="p">Barrels can also include resources. Resources are created and held within a Barrel in the same format as a regular application and are defined in XML format. See the <span class="xref"></span> section of the Programmer's Guide for more info on resources.</p><p class="p">The compiler will build the resource module as a sub-module of the Barrel's module. For example, in a Barrel called, <code class="ph codeph">IconLibrary</code> the module will look like this:</p><pre class="pre codeblock c++"><code>IconLibrary {                       // Barrel Level
    Rez {                           // Rez Level
        Drawables {                 // Drawables Level
            var myIcon = 123;       // Resource
        }
    }
}</code></pre><p class="p">Developers can reference resources within a Barrel by using the following syntax:</p><pre class="pre codeblock c++"><code>@IconLibrary.Drawables.myIcon</code></pre><p class="p">This makes it easy for developers to pull those resources into their projects without any changes. All files utilized by a Barrel must live in the Barrel project's root directory, determined by the directory of the manifest.xml file, as importing files external to the project is not supported.</p></div></article><article aria-labelledby="ariaid-title3" class="topic nested1" id="barrels-and-versions"><h2 class="title topictitle2" id="ariaid-title3">Barrels and Versions</h2><div class="body"><p class="p">Each Barrel has a unique version ID number. This follows the same numbering system as The Connect IQ SDK (<code class="ph codeph">Major.Minor.Micro.Quailifier</code> or <code class="ph codeph">#.#.#.X</code>). The version qualifier can only be comprised of letters, numbers, and underscores.</p></div></article><article aria-labelledby="ariaid-title4" class="topic nested1" id="exporting-a-monkey-barrel"><h2 class="title topictitle2" id="ariaid-title4">Exporting a Monkey Barrel</h2><div class="body"><p class="p">Monkey Barrels are packaged by the Monkey C compiler in order to satisfy a basic syntactical check of the source code.
<strong class="ph b">Note:</strong> While Barrels provide the mechanism of code libraries, they contain all of the unmodified source of your Barrel project.</p><p class="p">Do the following to export your Monkey Barrel:</p><ol class="ol"><li class="li"><p class="p">Make sure the manifest file specifies all products supported by the app</p></li><li class="li"><p class="p">Use the <em class="ph i">Monkey C: Export Project</em> command to generate an <code class="ph codeph">.barrel</code> file.</p></li></ol><p class="p">If there are no errors ,the barrel is ready to use!</p></div></article><article aria-labelledby="ariaid-title5" class="topic nested1" id="how-to-include-barrels"><h2 class="title topictitle2" id="ariaid-title5">How to Include Barrels</h2><div class="body"><p class="p">In order to use a Barrel, developers will need to add it to the current project. This can be done through the Visual Studio Code extension or by manually editing a project's Jungle and manifest file.</p></div><article aria-labelledby="ariaid-title6" class="topic nested2" id="adding-barrels-to-a-project-with-visual-studio-code"><h3 class="title topictitle3" id="ariaid-title6">Adding Barrels to a Project with Visual Studio Code</h3><div class="body"><p class="p">Developers can add new Barrels to their project through the command palette:</p><ol class="ol"><li class="li"><p class="p">Use the <em class="ph i">Monkey C: Configure Monkey Barrel</em> command</p></li><li class="li"><p class="p">Select <em class="ph i">Add Monkey Barrel</em></p></li><li class="li"><p class="p">Select if you want to add it as a precompiled <code class="ph codeph">.barrel</code> file or as a link to the barrel project</p></li><li class="li"><p class="p">Select the precompiled <code class="ph codeph">.barrel</code> file or the Monkey Barrel project <code class="ph codeph">.jungle</code> file, depending on the previous selection</p></li></ol><p class="p">The Barrels will be added to the default Barrel Jungle file automatically. The manifest file will also be updated with those Barrel dependencies. If a Barrel supports annotations, these must be manually configured for the individual Barrel, which will import the annotated portion of the Barrel into the project:</p><pre class="pre codeblock bash"><code># All products include the code
# annotated with 'Bars' and 'BarsToo'
# of the 'FooBarrel' barrel
base.FooBarrel.annotations = Bars;BarsToo</code></pre><div class="div note">See the [Build Configuration](../Core_Topics/Build_Configuration.md#buildconfiguration) section to see how to deal with Barrels in Jungle configuration files directly.</div><p class="p">Once this is done, the selected Barrels will be added to your project.</p></div></article></article><article aria-labelledby="ariaid-title7" class="topic nested1" id="using-monkey-barrels"><h2 class="title topictitle2" id="ariaid-title7">Using Monkey Barrels</h2><div class="body"><p class="p">Once they have been added to a project, using Barrels is straight forward and simple. It is not necessary for Developers to import Barrels into source files with the <code class="ph codeph">using</code> statement, however they will need a using statement if they choose to use aliases for them:</p><pre class="pre codeblock c++"><code>// This is a normal Toybox "using" statment
using Toybox.System;

// This sets up an alias for a "submodule" within a barrel
using FooBarrel.Bars as Bars;</code></pre><p class="p">At this point, the alias has been set up and the Barrel code has been made available in the project.</p><pre class="pre codeblock c++"><code>// This is a normal Connect IQ call
System.println("Cool Bars");

// This is a general Barrels call (No using statment needed)
FooBarrel.BarsToo.fancyBars();

// This is a specific Barrels call (Alias)
var globalBars = Bars.getCurrentBars();

// This is a call to use a resource held in a Barrel
var icon = UserInterface.loadResource(IconLibrary.Rez.Drawables.myIcon)</code></pre></div></article><article aria-labelledby="ariaid-title8" class="topic nested1" id="run-no-evil-and-monkey-barrels"><h2 class="title topictitle2" id="ariaid-title8">Run No Evil and Monkey Barrels</h2><div class="body"><p class="p">Barrels can be used in conjunction with the Run No Evil testing framework to test discrete sections of code. For more information on the Run No Evil testing framework developers can reference the <a class="xref" href="Unit_Testing.html#unit-testing">Run No Evil</a> documentation.</p><ol class="ol"><li class="li"><p class="p">Right click on the Barrel project root folder</p></li><li class="li"><p class="p">Select <em class="ph i">Run Tests</em></p></li></ol><p class="p">The Barrel code with the correct testing annotations (See <a class="xref" href="Unit_Testing.html#unit-testing">Run No Evil</a> documentation), will be tested in the Run No Evil testing framework.</p></div></article><article aria-labelledby="ariaid-title9" class="topic nested1" id="barrels-in-the-command-line"><h2 class="title topictitle2" id="ariaid-title9">Barrels In The Command Line</h2><div class="body"><p class="p">Barrels can be compiled and tested via the command line.</p><dl class="dl"><dt class="dt dlterm"><code class="ph codeph">barrelbuild</code></dt><dd class="dd"><p class="p">Calls the Monkey C Barrel compiler. Much like <code class="ph codeph">monkeyc</code> the <code class="ph codeph">barrelbuild</code> call takes code from multiple files to be included in the library (.barrel file). The <code class="ph codeph">-f</code> argument is required as the manifest file path is specified in one of the Barrel's Jungle files. For more info, run <code class="ph codeph">barrelbuild</code> without any arguments to see a full list of argument definitions.</p></dd></dl><pre class="pre codeblock"><code>&gt; barrelbuild -o &lt;output.barrel&gt; -f &lt;barrel.jungle&gt;</code></pre><dl class="dl"><dt class="dt dlterm"><code class="ph codeph">barreltest</code></dt><dd class="dd"><p class="p">Executes Run No Evil tests on the <code class="ph codeph">.barrel</code> file. Requires the <code class="ph codeph">-d</code> argument with a valid device id.</p></dd></dl><pre class="pre codeblock"><code>&gt; barreltest -o &lt;output.barrel&gt; -f &lt;barrel.jungle&gt; -d &lt;device_id&gt;</code></pre><p class="p">The Connect IQ team has provided a few useful example Barrels for developers to try. To use these Barrels, go to the Garmin Connect IQ <a class="xref" href="https://github.com/garmin/connectiq-apps" target="_blank">GitHub repository</a>. Clone or download the desired Barrels and add them to the project using one of the previously discussed methods.</p></div></article></article></main></div>
</body>
</html>