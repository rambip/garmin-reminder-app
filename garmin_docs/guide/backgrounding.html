<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Backgrounding - Garmin Connect IQ Documentation</title>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; margin: 0; padding: 20px; }
        h1 { color: #333; }
        pre { background-color: #f5f5f5; padding: 10px; border-radius: 4px; overflow: auto; }
        code { font-family: monospace; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; }
        th { background-color: #f2f2f2; }
        img { max-width: 100%; }
    </style>
</head>
<body>
    <h1>Backgrounding</h1>
    <div class="c0123 c0126">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><meta charset="utf-8"/><meta content="(C) Copyright 2025" name="copyright"/><meta content="(C) Copyright 2025" name="DC.rights.owner"/><meta content="topic" name="DC.type"/><meta content="HTML5" name="DC.format"/><meta content="background-services" name="DC.identifier"/><link href="../../commonltr.css" rel="stylesheet" type="text/css"/><title>Background Services</title><main role="main"><article aria-labelledby="ariaid-title1" role="article"><h1 class="title topictitle1" id="ariaid-title1">Background Services</h1><div class="body"><p class="p"><em class="ph i">Since API level 2.3.0</em></p><p class="p">Applications can register for background services. Services can be registered to run when various events occur. These events include when the user reaches goal targets, when sleep and wake times occur, when a steps threshold is reached, or at a scheduled time. Modules available to background processes differ from those of their parent application.</p><p class="p">Services may be terminated at any time free memory for foreground applications. Services will also be terminated automatically if the do not exit properly within 30 seconds of opening.</p></div><article aria-labelledby="ariaid-title2" class="topic nested1" id="registering-for-events"><h2 class="title topictitle2" id="ariaid-title2">Registering for Events</h2><div class="body"><p class="p">When your application runs you can register for events your application can subscribe to by using calls in the <a class="xref" href="https://developer.garmin.com/connect-iq/api-docs/Toybox/Background.html" target="_blank">Toybox.Background</a> module.</p><table class="table"><caption></caption><colgroup><col/><col/><col/><col/></colgroup><thead class="thead"><tr class="row"><th class="entry align-left" id="registering-for-events__entry__1">Event</th><th class="entry align-left" id="registering-for-events__entry__2">Description</th><th class="entry align-left" id="registering-for-events__entry__3">Register With</th><th class="entry align-left" id="registering-for-events__entry__4">API Level</th></tr></thead><tbody class="tbody"><tr class="row"><td class="entry align-left" headers="registering-for-events__entry__1">Activity Completed</td><td class="entry align-left" headers="registering-for-events__entry__2">Wakes your background service when the user completes an activity</td><td class="entry align-left" headers="registering-for-events__entry__3"><a class="xref" href="https://developer.garmin.com/connect-iq/api-docs/Toybox/Background.html#registerForActivityCompletedEvent-instance_function" target="_blank">Background.registerForActivityCompletedEvent()</a></td><td class="entry align-left" headers="registering-for-events__entry__4">3.1.0</td></tr><tr class="row"><td class="entry align-left" headers="registering-for-events__entry__1">Goal</td><td class="entry align-left" headers="registering-for-events__entry__2">Wakes your background service when the user meets one of their activity goals</td><td class="entry align-left" headers="registering-for-events__entry__3"><a class="xref" href="https://developer.garmin.com/connect-iq/api-docs/Toybox/Background.html#registerForGoalEvent-instance_function" target="_blank">Background.registerForGoalEvent()</a></td><td class="entry align-left" headers="registering-for-events__entry__4">2.3.0</td></tr><tr class="row"><td class="entry align-left" headers="registering-for-events__entry__1">OAUTH Response</td><td class="entry align-left" headers="registering-for-events__entry__2">Wakes your background service when the user completes the OAUTH flow</td><td class="entry align-left" headers="registering-for-events__entry__3"><a class="xref" href="https://developer.garmin.com/connect-iq/api-docs/Toybox/Background.html#registerForOAuthResponseEvent-instance_function" target="_blank">Background.registerForOAuthResponseEvent()</a></td><td class="entry align-left" headers="registering-for-events__entry__4">2.3.0</td></tr><tr class="row"><td class="entry align-left" headers="registering-for-events__entry__1">Phone App Message</td><td class="entry align-left" headers="registering-for-events__entry__2">Wakes your background service when your app receives a message from the Mobile SDK</td><td class="entry align-left" headers="registering-for-events__entry__3"><a class="xref" href="https://developer.garmin.com/connect-iq/api-docs/Toybox/Background.html#registerForPhoneAppMessageEvent-instance_function" target="_blank">Background.registerForPhoneAppMessageEvent()</a></td><td class="entry align-left" headers="registering-for-events__entry__4">3.2.0</td></tr><tr class="row"><td class="entry align-left" headers="registering-for-events__entry__1">Sleep</td><td class="entry align-left" headers="registering-for-events__entry__2">Wakes your background service at the time the user has configured as their sleep time</td><td class="entry align-left" headers="registering-for-events__entry__3"><a class="xref" href="https://developer.garmin.com/connect-iq/api-docs/Toybox/Background.html#registerForSleepEvent-instance_function" target="_blank">Background.registerForSleepEvent()</a></td><td class="entry align-left" headers="registering-for-events__entry__4">2.3.0</td></tr><tr class="row"><td class="entry align-left" headers="registering-for-events__entry__1">Steps</td><td class="entry align-left" headers="registering-for-events__entry__2">Wakes your background service every 1000 steps taken by the user</td><td class="entry align-left" headers="registering-for-events__entry__3"><a class="xref" href="https://developer.garmin.com/connect-iq/api-docs/Toybox/Background.html#registerForStepsEvent-instance_function" target="_blank">Background.registerForStepsEvent()</a></td><td class="entry align-left" headers="registering-for-events__entry__4">2.3.0</td></tr><tr class="row"><td class="entry align-left" headers="registering-for-events__entry__1">Temporal</td><td class="entry align-left" headers="registering-for-events__entry__2">Allows your service to be woken at a specific time or repeatedly at a certain interval (up to every five minutes)</td><td class="entry align-left" headers="registering-for-events__entry__3"><a class="xref" href="https://developer.garmin.com/connect-iq/api-docs/Toybox/Background.html#registerForTemporalEvent-instance_function" target="_blank">Background.registerForTemporalEvent()</a></td><td class="entry align-left" headers="registering-for-events__entry__4">2.3.0</td></tr></tbody></table></div></article><article aria-labelledby="ariaid-title3" class="topic nested1" id="making-a-servicedelegate"><h2 class="title topictitle2" id="ariaid-title3">Making a <code class="ph codeph">ServiceDelegate</code></h2><div class="body"><p class="p">When background services are started, the <a class="xref" href="https://developer.garmin.com/connect-iq/api-docs/Toybox/Application/AppBase.html#getServiceDelegate-instance_function" target="_blank">AppBase.getServiceDelegate()</a> is called. This method returns a <a class="xref" href="https://developer.garmin.com/connect-iq/api-docs/Toybox/System/ServiceDelegate.html" target="_blank">System.ServiceDelegate</a> and the method corresponding to the event that triggered is invoked. Once a background service has finished any necessary tasks, it should exit using the <a class="xref" href="https://developer.garmin.com/connect-iq/api-docs/Toybox/Background.html#exit-instance_function" target="_blank">Background.exit()</a> method. This method takes a argument containing data to be sent to the main process. Use null to provide no data.</p></div><article aria-labelledby="ariaid-title4" class="topic nested2" id="application-scope"><h3 class="title topictitle3" id="ariaid-title4">Application Scope</h3><div class="body"><p class="p">Background services are allowed to run at any time, including while the user is in an activity. In order to achieve this, the memory pool made available to background services is much smaller than what is available for the application. In many instances, the executable code of your application will be larger than the memory pool available.</p><p class="p">The Connect IQ compiler allows you to select what code is necessary for running in the background with the <code class="ph codeph">:background</code> annotation. Only modules, classes, functions and member variables decorated with the <code class="ph codeph">:background</code> annotation will be compiled into your background service. This means you must decorate all related code with the annotation (including your Application class).</p><pre class="pre codeblock typescript"><code>import Toybox.Application;
import Toybox.Background;
import Toybox.System;
import Toybox.Time;

// Because this is referenced in the application object
// constructor, it must be marked as background.
(:background)
var globalMember;

// Your application object has to be marked as background
// so that the service delegate can be referenced
(:background)
class MyApp extends Application.AppBase {

    // Constructor. Remember everything referenced in this function
    // must be marked as background
    public function initialize() {
        // Register to run every five minutes
        if(Background.getTemporalEventRegisteredTime() != null) {
            Background.registerForTemporalEvent(new Time.Duration(5 * 60))
        }
        // Initialize a global member
        $.globalMember = true;
    }

    public function getServiceDelegate() as [System.ServiceDelegate] {
        return [new MyServiceDelegate()];
    }

}

// Your service delegate has to be marked as background
// so it can handle your service callbacks
(:background)
class MyServiceDelegate extends System.ServiceDelegate {

    public function onTemporalEvent() as Void {
        // Do fun stuff here
    }

}</code></pre><p class="p">If your type check level is at <code class="ph codeph">informative</code> or above, the compiler will detect if your background service or any objects referenced is attempting to reference something not marked as background. See <a class="xref" href="../Monkey_C/Monkey_Types.html#monkey-types">Monkey Types</a> for more information.</p><p class="p">The resource compiler can control the scope level of your resources as well. See the <a class="xref" href="Resources.html#resource-scopes">Resources</a> section for more information.</p></div></article></article><article aria-labelledby="ariaid-title5" class="topic nested1" id="simulating-background-services"><h2 class="title topictitle2" id="ariaid-title5">Simulating Background Services</h2><div class="body"><p class="p">In the Connect IQ simulator, an option has been added under the Simulation menu, which allows manually triggering background services. When manually triggering a service, the background service for the most recently run application will be loaded, and the corresponding call in the <a class="xref" href="https://developer.garmin.com/connect-iq/api-docs/Toybox/System/ServiceDelegate.html" target="_blank">System.ServiceDelegate</a> will be triggered regardless of whether the application has registered for that event.</p></div></article></article></main></div>
</body>
</html>