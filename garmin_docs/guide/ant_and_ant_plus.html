<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Ant and Ant Plus - Garmin Connect IQ Documentation</title>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; margin: 0; padding: 20px; }
        h1 { color: #333; }
        pre { background-color: #f5f5f5; padding: 10px; border-radius: 4px; overflow: auto; }
        code { font-family: monospace; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; }
        th { background-color: #f2f2f2; }
        img { max-width: 100%; }
    </style>
</head>
<body>
    <h1>Ant and Ant Plus</h1>
    <div class="c0123 c0126">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><meta charset="utf-8"/><meta content="(C) Copyright 2025" name="copyright"/><meta content="(C) Copyright 2025" name="DC.rights.owner"/><meta content="topic" name="DC.type"/><meta content="HTML5" name="DC.format"/><meta content="ant-and-ant" name="DC.identifier"/><link href="../../commonltr.css" rel="stylesheet" type="text/css"/><title>ANT and ANT+</title><main role="main"><article aria-labelledby="ariaid-title1" role="article"><h1 class="title topictitle1" id="ariaid-title1">ANT and ANT+</h1><div class="body"><p class="p">The Sensor module of Connect IQ gives developers access to the built-in and paired sensors of the device. Connect IQ also provides access to the available ANT channels as well. This allows developers to communicate with sensors not supported by Garmin. Using the FIT recording system those metrics can be recorded to the Activity file and uploaded to Garmin Connect.</p><p class="p">Learn more about ANT and ANT+ at <a class="xref" href="http://thisisant.com" target="_blank">thisisant.com</a></p><table class="table"><caption></caption><colgroup><col/><col/><col/></colgroup><thead class="thead"><tr class="row"><th class="entry" id="ant-and-ant__entry__1">API</th><th class="entry" id="ant-and-ant__entry__2">Purpose</th><th class="entry" id="ant-and-ant__entry__3">API Level</th></tr></thead><tbody class="tbody"><tr class="row"><td class="entry" headers="ant-and-ant__entry__1"><a class="xref" href="https://developer.garmin.com/connect-iq/api-docs/Toybox/Ant.html" target="_blank">Toybox.Ant</a></td><td class="entry" headers="ant-and-ant__entry__2">Provides access to generic ANT channels. These allow direct communication between your app and an ANT device</td><td class="entry" headers="ant-and-ant__entry__3">1.0.0</td></tr><tr class="row"><td class="entry" headers="ant-and-ant__entry__1"><a class="xref" href="https://developer.garmin.com/connect-iq/api-docs/Toybox/AntPlus.html" target="_blank">Toybox.AntPlus</a></td><td class="entry" headers="ant-and-ant__entry__2">Allows access to ANT devices paired with the device.</td><td class="entry" headers="ant-and-ant__entry__3">2.2.0</td></tr></tbody></table></div><article aria-labelledby="ariaid-title2" class="topic nested1" id="generic-ant-channels"><h2 class="title topictitle2" id="ariaid-title2">Generic ANT Channels</h2><div class="body"><p class="p">Connect IQ provides a low level interface for communication with ANT and ANT+ sensors. With this interface, an ANT channel can be created to send and receive ANT packets.</p><p class="p">With an ANT USB dongle you can use Connect IQ ANT APIs in the Connect IQ Simulator. Note that Garmin Express will block access to the ANT USB dongle if it is running, so make sure to shut down Garmin Express when using the ANT USB dongle with the Connect IQ simulator.</p></div><article aria-labelledby="ariaid-title3" class="topic nested2" id="using-ant-stick-in-linux"><h3 class="title topictitle3" id="ariaid-title3">Using ANT stick in Linux</h3><div class="body"><p class="p">In order to use ANT stick in Linux the usb device should be accessible to the simulator. A udev rule must be installed in the system for the ANT stick to populate with non-root privileges.</p><p class="p">Find the vendor and product id for the ANT stick</p><pre class="pre codeblock bash"><code>$ lsusb</code></pre><p class="p">Identify the ANT stick in the list and its vendor and product id. example:</p><pre class="pre codeblock bash"><code>Bus 001 Device 009: ID 0fcf:1009 Dynastream Innovations, Inc. ANTUSB-m Stick</code></pre><p class="p">Create a udev rule for this device</p><pre class="pre codeblock bash"><code>$ sudo touch /etc/udev/rules.d/50-connectiq-usbant.rules
$ sudo nano /etc/udev/rules.d/50-connectiq-usbant.rules</code></pre><p class="p">Then add the line below to the file and save the changes: CTRL-x</p><pre class="pre codeblock bash"><code>ACTION=="add", SUBSYSTEMS=="usb", ATTRS{idVendor}=="0fcf", ATTRS{idProduct}=="1009", MODE="664", GROUP="plugdev"</code></pre><p class="p">Restart the udev service and plug the ANT stick</p><pre class="pre codeblock bash"><code>$ sudo /etc/init.d/udev restart</code></pre><p class="p">Add yourself to the 'plugdev' group</p><pre class="pre codeblock bash"><code>$ sudo usermod -a -G plugdev &lt;userName&gt;</code></pre></div></article></article><article aria-labelledby="ariaid-title4" class="topic nested1" id="communicating-with-a-tempe-sensor"><h2 class="title topictitle2" id="ariaid-title4">Communicating with a Tempe Sensor</h2><div class="body"><p class="p">The Environment Profile is supported by sensors like the Garmin tempeâ„¢ wireless environment sensor and makes it possible to read the minimum, maximum and current temperature.</p><p class="p">We can initialize an ANT channel to a tempe sensor with the following:</p><pre class="pre codeblock typescript"><code>    // Constructor
    function initialize() {
        // Get the channel
        chanAssign = new Ant.ChannelAssignment(
            Ant.CHANNEL_TYPE_RX_NOT_TX,
            Ant.NETWORK_PLUS);
        GenericChannel.initialize(method(:onMessage), chanAssign);

        // Set the configuration
        deviceCfg = new Ant.DeviceConfig( {
            :deviceNumber =&gt; 0,                 //Wildcard our search
            :deviceType =&gt; DEVICE_TYPE,
            :transmissionType =&gt; 0,
            :messagePeriod =&gt; PERIOD,
            :radioFrequency =&gt; 57,              //Ant+ Frequency
            :searchTimeoutLowPriority =&gt; 10,    //Timeout in 25s
            :searchTimeoutHighPriority =&gt; 2,    //Timeout in 5s
            :searchThreshold =&gt; 0} );           //Pair to all transmitting sensors
        GenericChannel.setDeviceConfig(deviceCfg);

        data = new TempeData();
        searching = true;
    }
</code></pre><p class="p">This code sets up the ANT channel assignment and sets device config and passes them to the base <a class="xref" href="https://developer.garmin.com/connect-iq/api-docs/Toybox/Ant/GenericChannel.html" target="_blank">Ant.GenericChannel</a> class. The device config is set to wildcard search to find any environment sensor. The initializer also sets up the <code class="ph codeph">onMessage</code> callback to handle incoming packets.</p><pre class="pre codeblock typescript"><code>    // Handle incoming information
    function onMessage(msg as Message) {
        // Parse the payload
        var payload = msg.getPayload();

        if( Ant.MSG_ID_BROADCAST_DATA == msg.messageId ) {
            if( TempeDataPage.PAGE_NUMBER == (payload[0].toNumber() &amp; 0xFF) ) {
                // Were we searching?
                if(searching) {
                    searching = false;

                    // Update our device configuration primarily to see
                    // the device number of the sensor we paired to
                    deviceCfg = GenericChannel.getDeviceConfig();
                }
                var dp = new TempeDataPage();
                dp.parse( msg.getPayload(), data );
                tempDataAvailable = true;
                // Check if the data has changed and we need to update the ui
                if( pastEventCount != data.eventCount ) {
                    pastEventCount = data.eventCount;
                }
            }
        } // end broadcast data

        else if( Ant.MSG_ID_CHANNEL_RESPONSE_EVENT == msg.messageId ) {
            if( Ant.MSG_ID_RF_EVENT == (payload[0] &amp; 0xFF) ) {
                if( Ant.MSG_CODE_EVENT_CHANNEL_CLOSED == (payload[1] &amp; 0xFF) ) {
                    open();
                }
                else if( Ant.MSG_CODE_EVENT_RX_FAIL_GO_TO_SEARCH  == (payload[1] &amp; 0xFF) ) {
                    searching = true;
                }
            }
            else{
                //It is a channel response.
            }
        } // end channel response event

    } // end on message
</code></pre><p class="p">The callback handles pairing with a nearby sensor, and handing incoming packets.</p><p class="p">The MO2Display sample provides a sample application that implements the Muscle Oxygen ANT profile. The ANT Generic interface is not available to watch faces. Low and high priority search timeout for sensors differs from the basic ANT radio specification to allow for interoperation with native ANT behavior on devices.  These are limited to a maximum timeout of 30 seconds and 5 seconds respectively.</p></div></article><article aria-labelledby="ariaid-title5" class="topic nested1" id="burst-data"><h2 class="title topictitle2" id="ariaid-title5">Burst Data</h2><div class="body"><p class="p"><em class="ph i">Since API level 2.2.0</em></p><p class="p">Burst data transmission provides a mechanism for large amounts of data to be sent between devices over an ANT Generic Channel. Developers are notified through a listener of the success/failure of burst transmit/receive events. Burst data transmission is limited to up to 8Kb of data at a time.</p><p class="p">Common use cases for this include passkey authentication or sending/receiving configuration data between devices.</p><p class="p">The <code class="ph codeph">GenericChannelBurst</code> sample provides a demonstration of transmitting and receiving burst data.</p></div></article><article aria-labelledby="ariaid-title6" class="topic nested1" id="ant-profiles"><h2 class="title topictitle2" id="ariaid-title6">ANT+ Profiles</h2><div class="body"><p class="p"><em class="ph i">Since API level 2.2.0</em></p><p class="p">The <a class="xref" href="https://developer.garmin.com/connect-iq/api-docs/Toybox/AntPlus.html" target="_blank">Toybox.AntPlus</a> module allows access to information about ANT+ sensors that are paired to a user's device without requiring you to set up and manage the ANT channel yourself. All management of ANT+ sensors such as adding, removing, enabling, disabling, and calibrating is managed by the user via the device's regular sensor menus.</p><p class="p">An extension of a sensor-specific listener is passed into the constructor for a sensor-specific extension of <a class="xref" href="https://developer.garmin.com/connect-iq/api-docs/Toybox/AntPlus/Device.html" target="_blank">AntPlus.Device</a>. If there is a sensor of the given type paired to the user's device, information about that sensor can be retrieved using the sensor-specific getters, or through the common data getters such as <a class="xref" href="https://developer.garmin.com/connect-iq/api-docs/Toybox/AntPlus/Device.html#getBatteryStatus-instance_function" target="_blank">Device.getBatteryStatus()</a>. <code class="ph codeph">null</code> can be passed in as the identifier for sensor types (like most) that do not support multi-components.</p><p class="p">Callbacks in the <a class="xref" href="https://developer.garmin.com/connect-iq/api-docs/Toybox/AntPlus/DeviceListener.html" target="_blank">AntPlus.DeviceListener</a> and extensions of it will be called automatically if a sensor of the given type is paired and the corresponding information is updated via ANT. For example, <a class="xref" href="https://developer.garmin.com/connect-iq/api-docs/Toybox/AntPlus/DeviceListener.html#onDeviceStateUpdate-instance_function" target="_blank">DeviceListener.onDeviceStateUpdate()</a> will be called if a sensor's ANT channel goes from connected to searching, or if the user switches the sensor ID of a given type that their device is connected to. Callbacks like <span class="xref"></span> will be called when new pieces of information about a power sensor are received via ANT.</p><p class="p">Certain ANT+ sensors, such as bike lights, have special callbacks. For example, the <span class="xref"></span>  callback should be used to understand the light network's state rather than <a class="xref" href="https://developer.garmin.com/connect-iq/api-docs/Toybox/AntPlus/DeviceListener.html#onDeviceStateUpdate-instance_function" target="_blank">DeviceListener.onDeviceStateUpdate()</a>. The <a class="xref" href="https://developer.garmin.com/connect-iq/api-docs/Toybox/AntPlus/LightNetwork.html" target="_blank">AntPlus.LightNetwork</a> class will allow you to make changes to bike light modes, given there are bike lights paired to the user's device and a light network is fully formed.</p><p class="p">Not all ANT+ profiles provisioned by Monkey C will be supported by every Connect IQ-compatible device.</p></div></article></article></main></div>
</body>
</html>